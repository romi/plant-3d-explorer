(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"./src/flow/scans/accessors.js":function(e,t,n){"use strict";n.r(t),n.d(t,"useScan",(function(){return N})),n.d(t,"useImageSet",(function(){return Q})),n.d(t,"useFile",(function(){return V})),n.d(t,"useSegmentedPointCloud",(function(){return B})),n.d(t,"use3dFile",(function(){return G})),n.d(t,"useScanFiles",(function(){return Y})),n.d(t,"useScans",(function(){return q})),n.d(t,"useSearchQuery",(function(){return z})),n.d(t,"useSorting",(function(){return D})),n.d(t,"useSortingMethod",(function(){return H})),n.d(t,"useFiltering",(function(){return J}));var a=n("./node_modules/react/index.js"),s=n("./node_modules/use-react-router/use-react-router.js"),r=n.n(s),c=n("./node_modules/axios/index.js");function i(e){if(e.isResolved)return e;var t=!0,n=!1,a=!1,s=e.then((function(e){return a=!0,t=!1,e}),(function(e){throw n=!0,t=!1,e}));return s.isFulfilled=function(){return a},s.isPending=function(){return t},s.isRejected=function(){return n},s}i&&i===Object(i)&&Object.isExtensible(i)&&Object.defineProperty(i,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"MakeQuerablePromise",filename:"src/rd/tools/promise.js"}});const o={};function l(e,t,n){return{data:null,query:i(Object(c.get)(e))}}const u=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=t&&o[e],[s,r]=Object(a.useState)(null),[i,u]=Object(a.useState)(!!n||!0),[f,m]=Object(a.useState)(!!o[e]&&(o[e].query.isFulfilled?o[e].data:null));return Object(a.useEffect)(()=>{let n,a=!1;if(e)if(t&&o[e])o[e].data?(u(!1),m(o[e].data)):o[e].query.then(e=>{u(!1),m(e.data)});else{m(null),u(!0),n=c.CancelToken.source();const s=l(e);t&&(o[e]=s),s.query.then(n=>{a||(t&&(o[e].data=n.data),m(n.data),u(!1))}).catch(e=>{a||(console.log(e),r(new Error(e)),u(!1))})}return()=>{a=!0,n&&n.cancel("Cancelling in cleanup")}},[e]),[f,i,s]};var f=u;u&&u===Object(u)&&Object.isExtensible(u)&&Object.defineProperty(u,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"useFetch",filename:"src/rd/tools/hooks/fetch.js"}});var m=n("./src/rd/tools/hooks/accessor.js"),b=n("./node_modules/three/build/three.module.js");const d=((j=b).PLYLoader=function(e){this.manager=void 0!==e?e:j.DefaultLoadingManager,this.propertyNameMapping={}},j.PLYLoader.prototype={constructor:j.PLYLoader,load:function(e,t,n,a){var s=this,r=new j.FileLoader(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.load(e,(function(e){t(s.parse(e))}),n,a)},setPath:function(e){return this.path=e,this},setPropertyNameMapping:function(e){this.propertyNameMapping=e},parse:function(e){function t(e){var t="",n=0,a=/ply([\s\S]*)end_header\r?\n/.exec(e);null!==a&&(t=a[1],n=a[0].length);for(var s,r,c,i,o,l,f={comments:[],elements:[],headerLength:n},m=t.split("\n"),b=0;b<m.length;b++){var d=m[b];if(""!==(d=d.trim()))switch(r=(c=d.split(/\s+/)).shift(),d=c.join(" "),r){case"format":f.format=c[0],f.version=c[1];break;case"comment":f.comments.push(d);break;case"element":void 0!==s&&f.elements.push(s),(s={}).name=c[0],s.count=parseInt(c[1]),s.properties=[];break;case"property":s.properties.push((i=c,o=u.propertyNameMapping,l=void 0,"list"===(l={type:i[0]}).type?(l.name=i[3],l.countType=i[1],l.itemType=i[2]):l.name=i[1],l.name in o&&(l.name=o[l.name]),l));break;default:console.log("unhandled",r,c)}}return void 0!==s&&f.elements.push(s),f}function n(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function a(e,t){for(var a=t.split(/\s+/),s={},r=0;r<e.length;r++)if("list"===e[r].type){for(var c=[],i=n(a.shift(),e[r].countType),o=0;o<i;o++)c.push(n(a.shift(),e[r].itemType));s[e[r].name]=c}else s[e[r].name]=n(a.shift(),e[r].type);return s}function s(e,t){var n,s={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},i="";null!==(n=/end_header\s([\s\S]*)$/.exec(e))&&(i=n[1]);for(var o=i.split("\n"),l=0,u=0,f=0;f<o.length;f++){var m=o[f];if(""!==(m=m.trim())){u>=t.elements[l].count&&(l++,u=0);var b=a(t.elements[l].properties,m);c(s,t.elements[l].name,b),u++}}return r(s)}function r(e){var t=new j.BufferGeometry;return e.indices.length>0&&t.setIndex(e.indices),t.addAttribute("position",new j.Float32BufferAttribute(e.vertices,3)),e.normals.length>0&&t.addAttribute("normal",new j.Float32BufferAttribute(e.normals,3)),e.uvs.length>0&&t.addAttribute("uv",new j.Float32BufferAttribute(e.uvs,2)),e.colors.length>0&&t.addAttribute("color",new j.Float32BufferAttribute(e.colors,3)),e.faceVertexUvs.length>0&&(t=t.toNonIndexed()).addAttribute("uv",new j.Float32BufferAttribute(e.faceVertexUvs,2)),t.computeBoundingSphere(),t}function c(e,t,n){if("vertex"===t)e.vertices.push(n.x,n.y,n.z),"nx"in n&&"ny"in n&&"nz"in n&&e.normals.push(n.nx,n.ny,n.nz),"s"in n&&"t"in n&&e.uvs.push(n.s,n.t),"red"in n&&"green"in n&&"blue"in n&&e.colors.push(n.red/255,n.green/255,n.blue/255);else if("face"===t){var a=n.vertex_indices||n.vertex_index,s=n.texcoord;3===a.length?(e.indices.push(a[0],a[1],a[2]),s&&6===s.length&&(e.faceVertexUvs.push(s[0],s[1]),e.faceVertexUvs.push(s[2],s[3]),e.faceVertexUvs.push(s[4],s[5]))):4===a.length&&(e.indices.push(a[0],a[1],a[3]),e.indices.push(a[1],a[2],a[3]))}}function i(e,t,n,a){switch(n){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,a),2];case"uint16":case"ushort":return[e.getUint16(t,a),2];case"int32":case"int":return[e.getInt32(t,a),4];case"uint32":case"uint":return[e.getUint32(t,a),4];case"float32":case"float":return[e.getFloat32(t,a),4];case"float64":case"double":return[e.getFloat64(t,a),8]}}function o(e,t,n,a){for(var s,r={},c=0,o=0;o<n.length;o++)if("list"===n[o].type){var l=[],u=(s=i(e,t+c,n[o].countType,a))[0];c+=s[1];for(var f=0;f<u;f++)s=i(e,t+c,n[o].itemType,a),l.push(s[0]),c+=s[1];r[n[o].name]=l}else s=i(e,t+c,n[o].type,a),r[n[o].name]=s[0],c+=s[1];return[r,c]}var l,u=this;if(e instanceof ArrayBuffer){var f=j.LoaderUtils.decodeText(new Uint8Array(e)),m=t(f);l="ascii"===m.format?s(f,m):function(e,t){for(var n,a={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},s="binary_little_endian"===t.format,i=new DataView(e,t.headerLength),l=0,u=0;u<t.elements.length;u++)for(var f=0;f<t.elements[u].count;f++){l+=(n=o(i,l,t.elements[u].properties,s))[1];var m=n[0];c(a,t.elements[u].name,m)}return r(a)}(e,m)}else l=s(e,t(e));return l}},j);var j;const p={},h=new d.PLYLoader;function O(e){return new Promise((t,n)=>{h.load(e,e=>{t(e)},()=>{},e=>{n(new Error(e))})})}function v(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=t&&p[e],[s,r]=Object(a.useState)(null),[c,i]=Object(a.useState)(!!n||!0),[o,l]=Object(a.useState)(!!n);return Object(a.useEffect)(()=>{let n=!1;return e&&(t&&p[e]?l(p[e]):(async()=>{if(!n){l(null),i(!0);try{const n=await O(e);t&&(p[e]=n),l(n)}catch(a){r(a)}i(!1)}})()),()=>{n=!0}},[e]),[o,c,s]}"undefined"!==typeof h&&h&&h===Object(h)&&Object.isExtensible(h)&&Object.defineProperty(h,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"loader",filename:"src/rd/tools/hooks/fetch3dObject.js"}});var g=v;v&&v===Object(v)&&Object.isExtensible(v)&&Object.defineProperty(v,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"useFetch3dObject",filename:"src/rd/tools/hooks/fetch3dObject.js"}});var y=n("./node_modules/lodash/lodash.js");function _(e,t){return e.reduce((e,t)=>t(e),t)}function x(e){return function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Object(y.filter)(n,[null,void 0,!1]).length?e(...n):1===n.length?Object(y.first)(n):n}}_&&_===Object(_)&&Object.isExtensible(_)&&Object.defineProperty(_,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"chain",filename:"src/rd/tools/enhancers.js"}}),x&&x===Object(x)&&Object.isExtensible(x)&&Object.defineProperty(x,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"ifNotNil",filename:"src/rd/tools/enhancers.js"}});"/scans"===Object("/scans")&&Object.isExtensible("/scans")&&Object.defineProperty("/scans","__filemeta",{enumerable:!0,configurable:!0,value:{name:"scansURI",filename:"src/common/api/index.js"}});const w=e=>"/scans"+(e?"?filterQuery="+e:"");w&&w===Object(w)&&Object.isExtensible(w)&&Object.defineProperty(w,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"scansURIQuery",filename:"src/common/api/index.js"}});const E=(e,t)=>"/files/"+e+"/"+t;E&&E===Object(E)&&Object.isExtensible(E)&&Object.defineProperty(E,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"getScanFile",filename:"src/common/api/index.js"}});const P=e=>""+e;P&&P===Object(P)&&Object.isExtensible(P)&&Object.defineProperty(P,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"getFile",filename:"src/common/api/index.js"}});const S=e=>"/scans/"+e;S&&S===Object(S)&&Object.isExtensible(S)&&Object.defineProperty(S,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"getScanURI",filename:"src/common/api/index.js"}});const U=e=>""+e;U&&U===Object(U)&&Object.isExtensible(U)&&Object.defineProperty(U,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"getScanPhotoURI",filename:"src/common/api/index.js"}});var I=n("./src/flow/scans/reducer.js"),F=n("./node_modules/natural-orderby/esm/natural-orderby.js");const M=new b.TextureLoader;M.crossOrigin="Anonymous";const R=e=>({...e,camera:{...e.camera,poses:e.camera.poses.map(e=>({...e,photoUri:U(e.photoUri)}))}});R&&R===Object(R)&&Object.isExtensible(R)&&Object.defineProperty(R,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"relativeScanPhotoURIEnhancer",filename:"src/flow/scans/enhancers.js"}});const T=e=>e.map(e=>({...e,thumbnailUri:U(e.thumbnailUri)}));T&&T===Object(T)&&Object.isExtensible(T)&&Object.defineProperty(T,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"relativeScansPhotoURIEnhancer",filename:"src/flow/scans/enhancers.js"}});const k=e=>e.map(e=>({...e,metadata:{...e.metadata,files:{archive:U(e.metadata.files.archive),metadatas:U(e.metadata.files.metadatas)}}}));k&&k===Object(k)&&Object.isExtensible(k)&&Object.defineProperty(k,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"relativeScansFilesURIEnhancer",filename:"src/flow/scans/enhancers.js"}});const L=e=>({...e,metadata:{...e.metadata,files:{archive:U(e.metadata.files.archive),metadatas:U(e.metadata.files.metadatas)}}});L&&L===Object(L)&&Object.isExtensible(L)&&Object.defineProperty(L,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"relativeScanFilesURIEnhancer",filename:"src/flow/scans/enhancers.js"}});const A=e=>{const t=e.camera.poses;let n=0;return{...e,camera:{...e.camera,poses:Object(F.a)(t,e=>e.photoUri).map(e=>{const t=new b.Matrix3;t.set(...e.rotmat[0],...e.rotmat[1],...e.rotmat[2]),t.transpose(),t.multiplyScalar(-1);const a=new b.Vector3(e.tvec[0],e.tvec[1],e.tvec[2]).applyMatrix3(t);function s(t){const n=new b.Matrix4;return n.set(...e.rotmat[0],0,...e.rotmat[1],0,...e.rotmat[2],0,0,0,0,1),n}const r=s(),c=(new b.Matrix4).makeRotationX(-Math.PI/2);r.transpose(),r.multiply(c);const i=s(),o=(new b.Matrix4).makeRotationX(-Math.PI);return i.transpose(),i.multiply(o),{index:n++,id:e.photoUri,fileName:Object(y.last)(e.photoUri.split("/")),...e,v3position:a,objM4rotation:r,vueM4rotation:i}})}}};A&&A===Object(A)&&Object.isExtensible(A)&&Object.defineProperty(A,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"forgeCameraPointsEnhancer",filename:"src/flow/scans/enhancers.js"}});const C=e=>e.map(e=>({path:e,texture:M.load(e)}));function N(){const{match:e}=r()(),t=e.params.scanId,[n]=f(S(t),!0);return[Object(a.useMemo)(()=>{if(n)return _([L,R,A],n)},[n])]}function Q(e){const{match:t}=r()(),n=t.params.scanId,[s]=f(E(n,"files.json"));return Object(a.useMemo)(()=>{if(!s)return null;const t=s.filesets.find(t=>t.id.toLowerCase().match(e));return t?C(t.files.map(e=>E(n,t.id+"/"+e.file))):null},[n,e,s])}function V(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{match:s}=r()(),c=s.params.scanId,[i]=f(E(c,"files.json")),o=Object(a.useMemo)(()=>{if(!i)return;const a=i.filesets.find(t=>t.id.match(e));return t&&a?E(c,(n.metadata?"metadata/":"")+a.id+"/"+(n.rawFileName?t:a.files.find(e=>e.file.match(t)).file)):a},[e,t,i,c,n]);return[f(o),o]}function B(){const[[e]]=G("SegmentedPointCloud","SegmentedPointCloud"),[[t]]=V("SegmentedPointCloud","SegmentedPointCloud.json",{metadata:!0,rawFileName:!0});return[e,t]}function G(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const[,a]=V(e,t,n);return[g(a),a]}function Y(e){return[g(e&&P(e.filesUri.mesh)),g(e&&P(e.filesUri.pointCloud)),g(e&&P(e.filesUri.pcdGroundTruth))]}function q(e){const[t]=f(w(e),!1);return[Object(a.useMemo)(()=>{if(t)return _([T,k],t)},[t])]}C&&C===Object(C)&&Object.isExtensible(C)&&Object.defineProperty(C,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"forgeImageSetEnhancer",filename:"src/flow/scans/enhancers.js"}}),N&&N===Object(N)&&Object.isExtensible(N)&&Object.defineProperty(N,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"useScan",filename:"src/flow/scans/accessors.js"}}),Q&&Q===Object(Q)&&Object.isExtensible(Q)&&Object.defineProperty(Q,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"useImageSet",filename:"src/flow/scans/accessors.js"}}),V&&V===Object(V)&&Object.isExtensible(V)&&Object.defineProperty(V,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"useFile",filename:"src/flow/scans/accessors.js"}}),B&&B===Object(B)&&Object.isExtensible(B)&&Object.defineProperty(B,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"useSegmentedPointCloud",filename:"src/flow/scans/accessors.js"}}),G&&G===Object(G)&&Object.isExtensible(G)&&Object.defineProperty(G,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"use3dFile",filename:"src/flow/scans/accessors.js"}}),Y&&Y===Object(Y)&&Object.isExtensible(Y)&&Object.defineProperty(Y,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"useScanFiles",filename:"src/flow/scans/accessors.js"}}),q&&q===Object(q)&&Object.isExtensible(q)&&Object.defineProperty(q,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"useScans",filename:"src/flow/scans/accessors.js"}});const z=Object(m.a)([e=>e.scans.searchQuery],[e=>({type:"SET_SEARCH_QUERY",value:e})]);"undefined"!==typeof z&&z&&z===Object(z)&&Object.isExtensible(z)&&Object.defineProperty(z,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"useSearchQuery",filename:"src/flow/scans/accessors.js"}});const D=Object(m.a)([e=>e.scans.sorting,e=>[...I.b.map(t=>t.label!==e.scans.sorting.label?t:e.scans.sorting)]],[e=>({type:"SET_SORTING",value:e})]);"undefined"!==typeof D&&D&&D===Object(D)&&Object.isExtensible(D)&&Object.defineProperty(D,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"useSorting",filename:"src/flow/scans/accessors.js"}});const H=Object(m.a)([e=>e.scans.sorting||"date"],[e=>({type:"SET_SORTING",value:e})]);"undefined"!==typeof H&&H&&H===Object(H)&&Object.isExtensible(H)&&Object.defineProperty(H,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"useSortingMethod",filename:"src/flow/scans/accessors.js"}});const J=Object(m.a)([e=>e.scans.filtering],[e=>({type:"SET_FILTERING",value:e})]);"undefined"!==typeof J&&J&&J===Object(J)&&Object.isExtensible(J)&&Object.defineProperty(J,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"useFiltering",filename:"src/flow/scans/accessors.js"}})},"./src/flow/scans/reducer.js":function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return s}));const a=[{label:"name",method:"asc",defaultMethod:"asc",type:"natural"},{label:"species",method:"asc",defaultMethod:"asc",type:"natural"},{label:"environment",method:"asc",defaultMethod:"asc",type:"natural"},{label:"date",method:"desc",defaultMethod:"desc",type:"date"}];"undefined"!==typeof a&&a&&a===Object(a)&&Object.isExtensible(a)&&Object.defineProperty(a,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"sortingMethods",filename:"src/flow/scans/reducer.js"}});const s={searchQuery:null,sorting:a.find(e=>"date"===e.label),filtering:{}};function r(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_SEARCH_QUERY":return{...e,searchQuery:t.value};case"SET_SORTING":return{...e,sorting:t.value};case"SET_FILTERING":return{...e,filtering:t.value};default:return e}}"undefined"!==typeof s&&s&&s===Object(s)&&Object.isExtensible(s)&&Object.defineProperty(s,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"initialState",filename:"src/flow/scans/reducer.js"}}),r&&r===Object(r)&&Object.isExtensible(r)&&Object.defineProperty(r,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"settingsReducer",filename:"src/flow/scans/reducer.js"}})},"./src/rd/tools/hooks/accessor.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n("./node_modules/react/index.js"),s=n("./node_modules/redux-react-hook/dist/index.es.js");function r(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return n=>{const r=Object(s.a)();return[...e.map(e=>Object(s.b)(Object(a.useCallback)(t=>e(t,n),[]))),...t.map(e=>Object(a.useCallback)(t=>r(e(t)),[]))]}}r&&r===Object(r)&&Object.isExtensible(r)&&Object.defineProperty(r,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"accessor",filename:"src/rd/tools/hooks/accessor.js"}})}}]);
//# sourceMappingURL=doc-fetching-data~src-viewer-interactors-index.4efed392e852c7595f99.js.map